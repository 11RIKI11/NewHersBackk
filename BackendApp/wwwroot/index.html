<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Тестирование</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        .endpoints {
            border-right: 1px solid #ccc;
            padding-right: 20px;
        }

        .endpoint {
            cursor: pointer;
            padding: 5px;
            margin: 5px 0;
        }

            .endpoint:hover {
                background: #f0f0f0;
            }

        .active {
            background: #e0e0e0;
        }

        textarea {
            width: 100%;
            height: 200px;
            margin: 10px 0;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
        }

        #response {
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="endpoints">
            <h3>Авторизация</h3>
            <div class="endpoint" data-method="POST" data-url="/api/v1/auth/login">Вход</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/auth/register">Регистрация</div>

            <h3>События</h3>
            <div class="endpoint" data-method="POST" data-url="/api/v1/events/search">Поиск событий</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/events">Создать событие</div>

            <h3>Билеты</h3>
            <div class="endpoint" data-method="POST" data-url="/api/v1/tickets/search">Поиск билетов</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/tickets/reserve">Резервировать билет</div>

            <h3>Платежи</h3>
            <div class="endpoint" data-method="POST" data-url="/api/v1/payments">Создать платеж</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/payments/search">Поиск платежей</div>

            <h3>Посетители</h3>
            <div class="endpoint" data-method="GET" data-url="/api/v1/attendees/{id}">Получить посетителя</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/attendees/search">Поиск посетителей</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/attendees">Создать посетителя</div>

            <h3>Календарь</h3>
            <div class="endpoint" data-method="POST" data-url="/api/v1/calendar/search">Поиск событий</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/calendar/events">Добавить событие</div>

            <h3>Изображения</h3>
            <div class="endpoint" data-method="GET" data-url="/api/v1/images/{id}">Получить изображение</div>
            <div class="endpoint" data-method="POST" data-url="/api/v1/images/search/by-type">Поиск по типу</div>
        </div>
        <div class="content">
            <div>
                <label>Token: <input type="text" id="token" style="width: 500px;"></label>
            </div>
            <h3>Request:</h3>
            <div>
                <label>URL: <input type="text" id="url" style="width: 500px;"></label>
                <select id="method">
                    <option>GET</option>
                    <option>POST</option>
                    <option>PUT</option>
                    <option>DELETE</option>
                </select>
            </div>
            <textarea id="request"></textarea>
            <button onclick="sendRequest()">Отправить</button>
            <h3>Response:</h3>
            <pre id="response"></pre>
        </div>
    </div>

    <script>
        const endpoints = {
            // Авторизация
            '/api/v1/auth/login': {
                method: 'POST',
                body: {
                    "email": "user1@mail.com",
                    "password": "password123"
                }
            },
            '/api/v1/auth/register': {
                method: 'POST',
                body: {
                    "fullName": "Тестовый Пользователь",
                    "email": "test@mail.com",
                    "password": "Password123!",
                    "phone": "+79001234567"
                }
            },
            // События
            '/api/v1/events/search': {
                method: 'POST',
                body: {
                    "filter": {
                        "title": ["Концерт"],
                        "location": ["Москва"],
                        "minPrice": 100,
                        "maxPrice": 5000,
                        "dateFrom": "2025-05-28T00:00:00",
                        "dateTo": "2025-12-31T23:59:59"
                    },
                    "sort": [
                        {
                            "sortBy": "startTime",
                            "sortDirection": "asc"
                        }
                    ],
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            },
            '/api/v1/events': {
                method: 'POST',
                body: {
                    "title": "Летний концерт 2025",
                    "description": "Большой летний концерт классической музыки",
                    "location": "Концертный зал, Москва",
                    "startDate": "2025-06-15T19:00:00",
                    "endDate": "2025-06-15T22:00:00",
                    "ticketCount": 100,
                    "price": 1500,
                    "tag": "concert"
                }
            },
            // Билеты
            '/api/v1/tickets/search': {
                method: 'POST',
                body: {
                    "filter": {
                        "status": ["Available", "Reserved"],
                        "eventIds": []
                    },
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            },
            '/api/v1/tickets/reserve': {
                method: 'POST',
                body: {
                    "eventId": "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                }
            },
            // Платежи
            '/api/v1/payments': {
                method: 'POST',
                body: {
                    "buyerId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
                    "amount": 3000,
                    "ticketIds": [
                        "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                    ]
                }
            },
            '/api/v1/payments/search': {
                method: 'POST',
                body: {
                    "filter": {
                        "minAmount": 100,
                        "maxAmount": 5000,
                        "status": ["WaitingForCapture", "Succeeded"],
                        "createdAtFrom": "2025-01-01T00:00:00",
                        "createdAtTo": "2025-12-31T23:59:59"
                    },
                    "sort": [
                        {
                            "sortBy": "createdAt",
                            "sortDirection": "desc"
                        }
                    ],
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            },
            // Добавить внутрь объекта endpoints
            // Посетители
            '/api/v1/attendees/search': {
                method: 'POST',
                body: {
                    "filter": {
                        "fullName": "Иванов",
                        "birthDateFrom": "1990-01-01",
                        "birthDateTo": "2000-12-31",
                        "docType": ["Passport"],
                        "docNumber": "4510"
                    },
                    "sort": [
                        {
                            "sortBy": "fullName",
                            "sortDirection": "asc"
                        }
                    ],
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            },
            '/api/v1/attendees': {
                method: 'POST',
                body: {
                    "fullName": "Иванов Иван Иванович",
                    "birthDate": "1990-01-15",
                    "documentType": "Passport",
                    "documentNumber": "4510123456",
                    "userId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
                    "ticketId": "3fa85f64-5717-4562-b3fc-2c963f66afa6"
                }
            },
            // Календарь
            '/api/v1/calendar/search': {
                method: 'POST',
                body: {
                    "filter": {
                        "fromDate": "2025-05-28T00:00:00",
                        "toDate": "2025-12-31T23:59:59"
                    },
                    "sort": [
                        {
                            "sortBy": "reminderTime",
                            "sortDirection": "asc"
                        }
                    ],
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            },
            '/api/v1/calendar/events': {
                method: 'POST',
                body: {
                    "eventId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
                    "note": "Не забыть паспорт",
                    "reminderTime": "2025-06-14T18:00:00"
                }
            },
            // Изображения
            '/api/v1/images/search/by-type': {
                method: 'POST',
                body: {
                    "imageType": "event",
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            },
            // Билеты (дополнительные эндпоинты)
            '/api/v1/tickets/available/{eventId}': {
                method: 'GET',
                body: null
            },
            '/api/v1/tickets/cancel-reserve/{eventId}': {
                method: 'POST',
                body: null
            },
            '/api/v1/tickets/me': {
                method: 'GET',
                body: {
                    "filter": {
                        "status": ["Reserved", "Paid"]
                    },
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            },
            // Пользователи
            '/api/v1/users/me': {
                method: 'GET',
                body: null
            },
            '/api/v1/users/search': {
                method: 'POST',
                body: {
                    "filter": {
                        "email": "user",
                        "phone": "+7900",
                        "roles": ["User", "Admin"]
                    },
                    "sort": [
                        {
                            "sortBy": "createdAt",
                            "sortDirection": "desc"
                        }
                    ],
                    "pagination": {
                        "page": 1,
                        "pageSize": 10
                    }
                }
            }
        };

        document.querySelectorAll('.endpoint').forEach(el => {
            el.addEventListener('click', () => {
                const url = el.dataset.url;
                document.getElementById('url').value = url;
                document.getElementById('method').value = endpoints[url].method;
                document.getElementById('request').value = JSON.stringify(endpoints[url].body, null, 2);

                document.querySelectorAll('.endpoint').forEach(e => e.classList.remove('active'));
                el.classList.add('active');
            });
        });

        // Добавить перед функцией sendRequest
        function isFileUpload(url) {
            return url.includes('/api/v1/images') && !url.includes('search');
        }

        // Изменить функцию sendRequest
        async function sendRequest() {
            const url = document.getElementById('url').value;
            const method = document.getElementById('method').value;
            const token = document.getElementById('token').value;
            const body = document.getElementById('request').value;

            try {
                const headers = {};
                let requestBody;

                if (isFileUpload(url)) {
                    // Для загрузки файлов не указываем Content-Type, он будет установлен автоматически
                    const formData = new FormData();
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    await new Promise((resolve) => {
                        fileInput.onchange = () => resolve();
                        fileInput.click();
                    });
                    formData.append('image', fileInput.files[0]);
                    // Добавляем остальные поля из JSON
                    const jsonData = JSON.parse(body);
                    Object.keys(jsonData).forEach(key => {
                        if (key !== 'image') {
                            formData.append(key, jsonData[key]);
                        }
                    });
                    requestBody = formData;
                } else {
                    headers['Content-Type'] = 'application/json';
                    requestBody = method !== 'GET' ? body : undefined;
                }

                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch(url, {
                    method: method,
                    headers: headers,
                    body: requestBody
                });

                const data = await response.json();
                document.getElementById('response').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('response').textContent = error.message;
            }
        }
    </script>
</body>
</html>